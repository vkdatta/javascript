window.initNoteApp=function(){window.notes=window.loadNotes();window.updateNoteVisibility();window.applyFontSize();window.setupModalSystem();window.setupUndoManager();window.setupNoteAppEventListeners();};
window.loadNotes=function(){const e=localStorage.getItem("notes");return e?JSON.parse(e):[{id:"1",title:"example",content:'console.log("Hello, World!");',extension:"js",lastEdited:new Date().toISOString(),password:""},{id:"2",title:"example",content:"<h1>Hello, World!</h1>",extension:"html",lastEdited:new Date().toISOString(),password:""},{id:"3",title:"example",content:"body { background: #fff; }",extension:"css",lastEdited:new Date().toISOString(),password:""},{id:"4",title:"example",content:'print("Hello, World!")',extension:"py",lastEdited:new Date().toISOString(),password:""},{id:"5",title:"note5",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"6",title:"note6",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"7",title:"note7",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"8",title:"note8",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"9",title:"note9",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"10",title:"note10",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"11",title:"note11",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"12",title:"note12",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"13",title:"note13",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"14",title:"note14",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""},{id:"15",title:"note15",content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""}];};
window.saveNotes=function(){localStorage.setItem("notes",JSON.stringify(window.notes));};
window.updateNoteVisibility=function(){localStorage.setItem("visibleNotes",window.visibleNotes);window.populateNoteList();};
window.populateNoteList=function(){if(!window.noteList){window.noteList=document.getElementById('noteList');}if(!window.noteList)return;window.noteList.innerHTML="";window.notes.slice(0,Math.max(1,window.visibleNotes)).forEach((n)=>{const t=document.createElement("li");t.className="note-item";t.dataset.id=n.id;t.innerHTML=`<span class="note-title">${n.title}</span><span class="note-badge">${n.content.length} chars | .${n.extension}</span>`;t.onclick=()=>{window.showNoteApp(n.id);};if(window.currentNote&&window.currentNote.id===n.id)t.classList.add("selected");window.noteList.appendChild(t);});};
window.openNote=function(e){const t=window.notes.find((n)=>n.id===e);if(!t)return;if(t.password){if(window.checkPassword)window.checkPassword(t,()=>{window.currentNote=t;if(window.noteTextarea)window.noteTextarea.value=t.content;window.updateDocumentInfo();document.querySelectorAll(".note-item").forEach((e)=>e.classList.remove("selected"));const e=document.querySelector(`.note-item[data-id="${t.id}"]`);if(e)e.classList.add("selected");});}else{window.currentNote=t;if(window.noteTextarea)window.noteTextarea.value=t.content;window.updateDocumentInfo();document.querySelectorAll(".note-item").forEach((e)=>e.classList.remove("selected"));const e=document.querySelector(`.note-item[data-id="${t.id}"]`);if(e)e.classList.add("selected");}};
window.getNextEmptyNote=function(){return window.notes.find((e)=>!e.content);};
window.handleNewDocument=function(){if(window.visibleNotes>=window.maxNotes){window.showNotification("Max notes limit reached! Clear a note to continue.");return;}const e=window.getNextEmptyNote();if(e){window.visibleNotes=1;window.updateNoteVisibility();window.openNote(e.id);window.showNotification("New document created!");}else{const t={id:Date.now().toString(),title:`note${window.notes.length+1}.txt`,content:"",extension:"txt",lastEdited:new Date().toISOString(),password:""};window.notes.push(t);window.visibleNotes=1;window.updateNoteVisibility();window.openNote(t.id);window.showNotification("New document created!");}};
window.handleOpenFile=function(){const e=window.getNextEmptyNote();if(!e){window.showNotification("No empty notes available! Clear a note to continue.");return;}const t=document.createElement("input");t.type="file";t.accept=".txt,.md,.csv,.json,.xml,.yml,.yaml,.js,.ts,.jsx,.tsx,.html,.css,.py,.java,.c,.cpp,.h,.go,.rb,.php,.rs,.swift,.sh,.bat,Dockerfile,Makefile,.env,.ini,.toml,.conf,.log,.dockerignore";t.onchange=function(o){const n=o.target.files[0];if(n){const r=new FileReader();r.onload=function(o){let x=n.name.split("."),a=x.pop().toLowerCase(),base=x.join(".");e.title=base;e.content=o.target.result;e.extension=a;e.lastEdited=new Date().toISOString();window.visibleNotes=1;window.updateNoteVisibility();window.openNote(e.id);window.showNotification("File opened!");};r.readAsText(n);}};t.click();};
window.handlePasteNote=async function(){if(!window.currentNote||!window.noteTextarea)return;if(!navigator.clipboard){window.showNotification("Clipboard not supported in this browser.");return;}try{const text=await navigator.clipboard.readText();const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd;window.noteTextarea.value=window.noteTextarea.value.slice(0,s)+text+window.noteTextarea.value.slice(e);const n=s+text.length;window.noteTextarea.selectionStart=window.noteTextarea.selectionEnd=n;window.updateNoteMetadata();window.showNotification("Pasted from clipboard!");}catch{window.showNotification("Paste failed (permission denied or empty clipboard).");}};
window.updateNoteMetadata=function(){if(!window.currentNote||!window.noteTextarea)return;window.undoStack.push({content:window.currentNote.content,selectionStart:window.noteTextarea.selectionStart,selectionEnd:window.noteTextarea.selectionEnd});window.redoStack=[];window.currentNote.content=window.noteTextarea.value;window.currentNote.lastEdited=new Date().toISOString();window.saveNotes();window.updateDocumentInfo();};
window.updateDocumentInfo=function(){if(!window.currentNote){if(window.infoName)window.infoName.textContent="-";if(window.infoStats)window.infoStats.textContent="{0 | 0 | 0} / 0m";return;}var e=window.currentNote,t=e.title,n=e.content,o=e.extension,l=n.length,a=n.replace(/\s/g,"").length,i=n.trim().split(/\s+/).filter((w)=>w).length,r=Math.ceil(i/200),c=r<60?r+"m":(r/60).toFixed(1)+"h";if(window.infoName)window.infoName.textContent=t+(o?"."+o:"");if(window.infoStats)window.infoStats.textContent=`{${a} | ${l} | ${i}} / ${c}`;};
window.applyFontSize=function(){if(window.noteTextarea){window.noteTextarea.style.fontSize=`${window.fontSize}px`;localStorage.setItem("fontSize",window.fontSize);}};
window.increaseFontSize=function(){window.fontSize=Math.min(window.fontSize+2,42);window.applyFontSize();window.showNotification(`Font size increased to ${window.fontSize}px`);};
window.decreaseFontSize=function(){window.fontSize=Math.max(window.fontSize-2,10);window.applyFontSize();window.showNotification(`Font size decreased to ${window.fontSize}px`);};
window.preserveSelection=function(handler){return()=>{if(!window.noteTextarea)return;const start=window.noteTextarea.selectionStart;const end=window.noteTextarea.selectionEnd;handler();window.noteTextarea.setSelectionRange(start,end);};};
window.handleUppercase=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd,v=window.noteTextarea.value;if(!v)return;const f=s===e?v.toUpperCase():v.slice(0,s)+v.slice(s,e).toUpperCase()+v.slice(e);window.noteTextarea.value=f;window.updateNoteMetadata();window.showNotification("Converted to uppercase!");});
window.handleLowercase=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd,v=window.noteTextarea.value;if(!v)return;const f=s===e?v.toLowerCase():v.slice(0,s)+v.slice(s,e).toLowerCase()+v.slice(e);window.noteTextarea.value=f;window.updateNoteMetadata();window.showNotification("Converted to lowercase!");});
window.handleAlignLeft=function(){if(!window.noteTextarea)return;window.noteTextarea.style.textAlign="left";window.showNotification("Text aligned left!");};
window.handleAlignCenter=function(){if(!window.noteTextarea)return;window.noteTextarea.style.textAlign="center";window.showNotification("Text aligned center!");};
window.handleAlignRight=function(){if(!window.noteTextarea)return;window.noteTextarea.style.textAlign="right";window.showNotification("Text aligned right!");};
window.increaseIndentation=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd;if(s===e){window.showNotification("Please select text to indent!");return;}const t=window.noteTextarea.value.slice(s,e),i="\t"+t.replace(/\n/g,"\n\t");window.noteTextarea.value=window.noteTextarea.value.slice(0,s)+i+window.noteTextarea.value.slice(e);window.updateNoteMetadata();window.showNotification("Text indented!");});
window.decreaseIndentation=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd;if(s===e){window.showNotification("Please select text to un-indent!");return;}const t=window.noteTextarea.value.slice(s,e).split("\n"),i=t.map((e)=>e.startsWith("\t")?e.slice(1):e.startsWith("    ")?e.slice(4):e).join("\n");window.noteTextarea.value=window.noteTextarea.value.slice(0,s)+i+window.noteTextarea.value.slice(e);window.updateNoteMetadata();window.showNotification("Indentation removed!");});
window.handleSelectAll=function(){if(!window.currentNote||!window.noteTextarea)return;window.noteTextarea.setSelectionRange(0,window.noteTextarea.value.length);window.noteTextarea.focus();window.showNotification("All text selected!");};
window.handleCopyNote=function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd,t=s===e?window.noteTextarea.value:window.noteTextarea.value.slice(s,e);navigator.clipboard.writeText(t).then(()=>window.showNotification("Copied to clipboard!")).catch(()=>window.showNotification("Copy failed (clipboard not available)."));};
window.handleCutNote=function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd,t=s===e?window.noteTextarea.value:window.noteTextarea.value.slice(s,e);navigator.clipboard.writeText(t).then(()=>{window.noteTextarea.value=s===e?"":window.noteTextarea.value.slice(0,s)+window.noteTextarea.value.slice(e);window.noteTextarea.selectionStart=window.noteTextarea.selectionEnd=s;window.updateNoteMetadata();window.showNotification("Cut to clipboard!");}).catch(()=>window.showNotification("Cut failed (clipboard not available)."));};
window.handleClearNote=window.preserveSelection(function(){if(!window.currentNote||!window.noteTextarea)return;const s=window.noteTextarea.selectionStart,e=window.noteTextarea.selectionEnd,v=window.noteTextarea.value;if(s===e){window.noteTextarea.value="";}else{window.noteTextarea.value=v.slice(0,s)+v.slice(e);}window.updateNoteMetadata();window.showNotification("Note cleared!");});
window.setupNoteAppEventListeners=function(){if(window.noteTextarea)window.safeAddListener(window.noteTextarea,"input",window.updateNoteMetadata);};
window.setupModalSystem=function(){console.log("Modal system placeholder - include modal functions here");};
window.setupUndoManager=function(){console.log("Undo manager placeholder - include undo functions here");};
