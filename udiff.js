window.text1=null;window.text2=null;window.compareBtn=null;window.clearBtn=null;window.swapBtn=null;window.linesLeft=null;window.linesRight=null;window.diffSummary=null;window.diffCountEl=null;window.lineCountEl=null;window.saveSelLeftBtn=null;window.saveSelRightBtn=null;window.applySwapBtn=null;window.swapDirectionEl=null;window.selectionInfo=null;window.uploadBtn1=null;window.uploadBtn2=null;window.fileInput1=null;window.fileInput2=null;window.savedLeft=null;window.savedRight=null;window.state={scrollSync:!0,showWordDiff:!0};window.WORD_DIFF_THRESHOLD=60;window.LINE_DIFF_THRESHOLD=1e3;
window.clearAll=function(){window.text1&&(window.text1.value=""),window.text2&&(window.text2.value=""),window.linesLeft&&(window.linesLeft.innerHTML=""),window.linesRight&&(window.linesRight.innerHTML=""),window.diffSummary&&(window.diffSummary.innerHTML=""),window.diffCountEl&&(window.diffCountEl.textContent="0"),window.lineCountEl&&(window.lineCountEl.textContent="0"),window.selectionInfo&&(window.selectionInfo.textContent="")};
window.swapTexts=function(){if(window.text1&&window.text2){var e=window.text1.value;window.text1.value=window.text2.value,window.text2.value=e,window.compareTexts()}};
window.escapeHTML=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")};
window.compareTexts=function(){if(!window.text1||!window.text2)return;var e=window.text1.value,t=window.text2.value;if(!e&&!t)return window.diffSummary&&(window.diffSummary.innerHTML="<p>Both texts are empty</p>"),void 0;var n=e.split("\n"),o=t.split("\n");if(n.length>window.LINE_DIFF_THRESHOLD||o.length>window.LINE_DIFF_THRESHOLD)return window.fastLineDiff(e,t),void 0;window.detailedDiff(n,o)};window.setupScrollSync=function(){if(window.text1&&window.text2){var e=function(e){var t=e.target===window.text1?"left":"right",n=e.target.scrollTop,o=e.target.scrollLeft;t==="left"?(window.text2.scrollTop=n,window.text2.scrollLeft=o,window.linesRight.scrollTop=n):(window.text1.scrollTop=n,window.text1.scrollLeft=o,window.linesLeft.scrollTop=n)};window.text1.addEventListener("scroll",e),window.text2.addEventListener("scroll",e)}};
window.fastLineDiff=function(e,t){var n=e.split("\n"),o=t.split("\n"),i=n.length,r=o.length,a=Math.min(i,r),l=0,c=0,s=0;for(var u=0;u<a;u++)n[u]!==o[u]&&l++;for(var d=i;d>a;d--)n[d-1]!==o[d-1]&&c++;for(var p=r;p>a;p--)n[p-1]!==o[p-1]&&s++;var h="<p>Fast comparison (large text):</p>";h+="<p>Matching lines: "+(a-l)+"</p>",h+="<p>Different lines: "+l+"</p>",h+="<p>Extra lines in left: "+c+"</p>",h+="<p>Extra lines in right: "+s+"</p>",window.diffSummary&&(window.diffSummary.innerHTML=h),window.diffCountEl&&(window.diffCountEl.textContent=l.toString()),window.lineCountEl&&(window.lineCountEl.textContent=(a+c+s).toString())};
window.detailedDiff=function(e,t){var n=0,o=0,i=0,r=0,a=0,l="",c="",s=0,u=0,d=0;function p(e,t){for(var n=e.split(/\b/),o=t.split(/\b/),i=0,r=0,a=0,l=0;l<Math.min(n.length,o.length);l++)n[l]!==o[l]&&(i++,r+=n[l].length,a+=o[l].length);return{diffCount:i,leftDiffChars:r,rightDiffChars:a}}for(var h=0;h<Math.max(e.length,t.length);h++){var f=e[h]||"",g=t[h]||"";f===g?(l+='<div class="line same">'+(h+1)+"</div>",c+='<div class="line same">'+(h+1)+"</div>",n++,o++):(f&&g?(window.state.showWordDiff&&f.length<window.WORD_DIFF_THRESHOLD&&g.length<window.WORD_DIFF_THRESHOLD){var v=p(f,g);v.diffCount>0?(i++,r+=v.leftDiffChars,a+=v.rightDiffChars,l+='<div class="line diff-word">'+(h+1)+"</div>",c+='<div class="line diff-word">'+(h+1)+"</div>"):(l+='<div class="line diff">'+(h+1)+"</div>",c+='<div class="line diff">'+(h+1)+"</div>",i++)}:(l+='<div class="line diff">'+(h+1)+"</div>",c+='<div class="line diff">'+(h+1)+"</div>",i++)),f&&!g?(l+='<div class="line removed">'+(h+1)+"</div>",c+='<div class="line empty">'+(h+1)+"</div>",s++):!f&&g?(l+='<div class="line empty">'+(h+1)+"</div>",c+='<div class="line added">'+(h+1)+"</div>",u++):d++)}window.linesLeft&&(window.linesLeft.innerHTML=l),window.linesRight&&(window.linesRight.innerHTML=c);var m="<p>Detailed comparison:</p>";m+="<p>Same lines: "+n+"</p>",m+="<p>Different lines: "+i+"</p>",m+="<p>Removed lines: "+s+"</p>",m+="<p>Added lines: "+u+"</p>",window.state.showWordDiff&&(m+="<p>Word differences detected: "+d+"</p>"),window.diffSummary&&(window.diffSummary.innerHTML=m),window.diffCountEl&&(window.diffCountEl.textContent=i.toString()),window.lineCountEl&&(window.lineCountEl.textContent=(n+i+s+u).toString())};
window.commonPrefix=function(e,t){for(var n=0;n<Math.min(e.length,t.length)&&e[n]===t[n];n++);return n};window.commonSuffix=function(e,t,n){n=n||Math.min(e.length,t.length);for(var o=0;o<n&&e[e.length-1-o]===t[t.length-1-o];o++);return o};window.swapLine=function(e,t,n){var o=e.split("\n"),i=t.split("\n"),r=parseInt(n,10);if(r>=0&&r<Math.min(o.length,i.length)){var a=o[r];o[r]=i[r],i[r]=a;var l=o.join("\n"),c=i.join("\n");window.text1.value=l,window.text2.value=c,window.compareTexts()}};
window.handleFileUpload1=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){window.text1.value=e.target.result},n.readAsText(t)}};window.handleFileUpload2=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){window.text2.value=e.target.result},n.readAsText(t)}};
window.initDiffChecker=function(){window.text1=document.getElementById("text1"),window.text2=document.getElementById("text2"),window.compareBtn=document.getElementById("compareBtn"),window.clearBtn=document.getElementById("clearBtn"),window.swapBtn=document.getElementById("swapBtn"),window.linesLeft=document.getElementById("linesLeft"),window.linesRight=document.getElementById("linesRight"),window.diffSummary=document.getElementById("diffSummary"),window.diffCountEl=document.getElementById("diffCount"),window.lineCountEl=document.getElementById("lineCount"),window.saveSelLeftBtn=document.getElementById("saveSelLeftBtn"),window.saveSelRightBtn=document.getElementById("saveSelRightBtn"),window.applySwapBtn=document.getElementById("applySwapBtn"),window.swapDirectionEl=document.getElementById("swapDirection"),window.selectionInfo=document.getElementById("selectionInfo"),window.uploadBtn1=document.getElementById("uploadBtn1"),window.uploadBtn2=document.getElementById("uploadBtn2"),window.fileInput1=document.getElementById("fileInput1"),window.fileInput2=document.getElementById("fileInput2"),window.setupEventListeners(),window.setupScrollSync()};
window.setupEventListeners=function(){function e(e,t,n){e?e.addEventListener(t,n):console.warn("Element for "+t+" listener not found")}e(window.compareBtn,"click",window.compareTexts),e(window.clearBtn,"click",window.clearAll),e(window.swapBtn,"click",window.swapTexts),e(window.saveSelLeftBtn,"click",function(){window.text1&&(window.savedLeft={start:window.text1.selectionStart,end:window.text1.selectionEnd},window.updateSelectionInfo())}),e(window.saveSelRightBtn,"click",function(){window.text2&&(window.savedRight={start:window.text2.selectionStart,end:window.text2.selectionEnd},window.updateSelectionInfo())}),e(window.applySwapBtn,"click",function(){if(window.savedLeft&&window.savedRight){var e=window.swapDirectionEl?window.swapDirectionEl.value:"both";window.swapLine(window.text1.value,window.text2.value,window.savedLeft.start.toString())}}),e(window.text1,"input",function(){window.state.autoCompare&&window.compareTexts()}),e(window.text2,"input",function(){window.state.autoCompare&&window.compareTexts()}),e(window.uploadBtn1,"click",function(){window.fileInput1&&window.fileInput1.click()}),e(window.uploadBtn2,"click",function(){window.fileInput2&&window.fileInput2.click()}),e(window.fileInput1,"change",window.handleFileUpload1),e(window.fileInput2,"change",window.handleFileUpload2)};window.updateSelectionInfo=function(){var e=window.savedLeft?"L: "+window.savedLeft.start+"-"+window.savedLeft.end:"L: none",t=window.savedRight?"R: "+window.savedRight.start+"-"+window.savedRight.end:"R: none";window.selectionInfo&&(window.selectionInfo.textContent=e+" | "+t)};window.initDiffChecker();
